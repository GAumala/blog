<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Japanese,dictionary,Android,Kotlin,Room,coroutines">
    <meta name="description" content="Announcing a Japanese dictionary Android app" />
    <meta name="twitter:card" content="summary">
    <meta name="twitter:description" content="Announcing a Japanese dictionary Android app">
    <meta property="og:locale" content="es_US">
    <meta property="og:title" content="Announcing OpenJisho">
    <meta property="og:description" content="Announcing a Japanese dictionary Android app">
    <title>Announcing OpenJisho</title>
    <link rel="stylesheet" href="../css/post-bundle.css" />
  </head>
  <body>
    <header>
      <nav>
        <a href="../" title="Home">
          <img id="home" src="../assets/images/home.svg" alt="Home"></a>
        <a href="../rss/posts.rss" title="RSS feed">
          <img class="icon-rss" src="../assets/images/rss.svg" alt="RSS"></a>
        <a href="https://twitter.com/gaumala987" title="Twitter profile">
          <img class="icon" src="../assets/images/twitter.svg" alt="Twitter"></a>
        <a href="https://github.com/GAumala" title="GitHub profile">
          <img class="icon" src="../assets/images/github.svg" alt="GitHub"></a>
      </nav>
    </header>

    <h1 class="post-title">Announcing OpenJisho</h1>
    <div class="date"><span>November 21, 2021</span></div>
    <article>
      <section>
        <p>I’m happy to announce that I am releasing “OpenJisho”, a Japanese dictionary app in the Google Play store today. As implied by the name is completely open source and you can get the source code on <a href="https://github.com/GAumala/OpenJisho">GitHub</a>. If this sort of thing piques your curiosity, in this post I’ll go into detail about this app and explain some of the technical decisions of the project.</p>
<!--more-->
<h2 id="what-it-does">What it does?</h2>
<p>This app let’s you type any word, in English or Japanese, and it will show you any matching entries for well known dictionary files like <a href="https://www.edrdg.org/jmdict/edict.html">JMdict</a> and <a href="https://www.edrdg.org/wiki/index.php/KANJIDIC_Project">KANJIDIC</a>.</p>
<p><a href="../assets/images/openjisho_01.jpg"><img src="../assets/images/openjisho_01.jpg" /></a></p>
<p>Additionally, there is a “Sentences” tab that will show you matching example sentences from the <a href="https://tatoeba.org/en/">Tatoeba project</a>.</p>
<p><a href="../assets/images/openjisho_02.jpg"><img src="../assets/images/openjisho_02.jpg" /></a></p>
<p>If you want to search entries or sentences with a particular kanji, but you don’t know how to type it in, there is a feature that lets you search it by radicals using <a href="https://www.edrdg.org/krad/kradinf.html">RADKFILE</a>.</p>
<p><a href="../assets/images/openjisho_03.jpg"><img src="../assets/images/openjisho_03.jpg" /></a></p>
<p>All queries work offline because dictionary files are downloaded during the first time setup and stored in a SQLite database. An internet connection is only required during the setup.</p>
<h2 id="technical-details">Technical details</h2>
<p>The rest of this post is aimed at Android developers, so you can stop reading if this isn’t you. This codebase reflects pretty much all my opinions about Android development. I started this project two years ago, so it doesn’t have all the newest tools like Compose or Navigation. I avoid adding libraries unless I really need them. Most of the time I try to use what the Android platform already has or I try to implement it myself, unless it’s not worth the effort. For example I use <code>HTTPUrlConnection</code> for downloads and <code>JSONObject</code> for JSON serializing/deserializing. I don’t use dependency injection frameworks either. I think they are too complex. Dependency injection is important though. I just do it manually, creating objects as they are needed in factory classes.</p>
<p>The App architechture is MVI. I use my own implementation, which I’ve already written about <a href="./2019-04-30-writing-mvi-apps-in-android.html">in the past</a>, so I won’t talk too much about it here. It is designed as a single activity application, so every screen is implemented as a <code>Fragment</code> class. I transition between fragments manually using fragment transactions, <a href="./2020-05-03-navigating-with-fragments.html">as described in this previous post</a>. Most transitions use a simple “slide” animation implemented in XML. Some of them, like the one used for search by radicals, use the <a href="https://developer.android.com/training/transitions">Transitions API</a>, which looks really cool. All transition animations are implemented in the <code>MainTransitions</code> class, in case you want to check them out.</p>
<p>A funny thing about animations in this app, is that I added second activity only because I wanted to use the default animation that Android uses for activities. I really liked the default animation that android uses when it launches a new activity on my Oreo phone, so I tried implementing it for fragment transitions. Unfortunately, it was not possible. I don’t remember the exact reason, but I think it was because it was implemented in a private XML file in the Oreo source code, which made it unavailable on older Android versions. So for things like entry details, I launch a secondary activity to display the next fragment just for the free animated transition. I may end up removing this later on. Having a single activity makes things a lot simpler.</p>
<p>For the SQLite database I use <a href="https://developer.android.com/training/data-storage/room/">Room</a>. There is a lot I could write about Room and how I use it for dictionary queries, but it would probably be long enough to warrant its own post. Overall I’m really happy with it, specially with the support for full-text search, which helps a lot when searching for sentences. The only problem that I have is that there is no easy way to rank full-text search results by relevance. For dictionary entries, I do try to move exact matches to the top of the list, but I use pagination to display the results list. If the best result is not on the first page, there’s nothing I can do about it. <em>If only the mega corporation behind Room had some experience with search engines…</em></p>
<p>The first time setup that populates the the SQLite database is another very large topic that could have its own post. It has to download a few files, parse them, and store the parsed data into the database in a way that is properly indexed. This is done concurrently using <a href="https://kotlinlang.org/docs/coroutines-overview.html">coroutines</a>. It’s really good. I can’t imagine doing this before coroutines got released. I also use a <a href="https://developer.android.com/guide/components/foreground-services">foreground service</a> to avoid getting killed by the OS when it needs to reclaim some memory. However, even with that, there’s still plenty of work needed to make it robust. Also, users have to be aware of what is going on while they wait so every concurrent task has to report progress at every step. This is a great use case for <a href="https://kotlinlang.org/docs/channels.html">channels</a>. If you are interested the whole setup, you can check the <code>SetupWorker</code> class. This is probably the most mission critical class of the app so I added plenty of unit tests to ensure that it works correctly and that it’s able to handle unexpected errors.</p>
<p>I could go on all day talking about the implementation details of this app, but I think I should wrap it up here. If you are interested in working with the codebase but have questions, feel free to open an issue on GitHub and I’ll try to help. I do hope to get a few collaborators for maintenance and new features.</p>
      </section>
    </article>

    <div class="footer-separator"></div>
    <div id="like-footer"></div>
    <script src="../js/post.js"></script>
  </body>
</html>
